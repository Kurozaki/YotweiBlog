<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Yotwei博客 | 文章列表</title>

    <link rel="stylesheet" href="../static/css/yot-nav.css">
    <link rel="stylesheet" href="../static/css/font-awesome.css">
    <link rel="stylesheet" href="../static/css/animate.css">
    <link rel="stylesheet" href="../static/css/yot-style.css">

    <script src="../static/js/jquery-3.2.1.min.js"></script>
    <script src="../static/js/functions.js"></script>

    <style>
        body {
            background: url("../static/images/bj.png");
            background-repeat: repeat;
            background-attachment: fixed;
            overflow-y: scroll;
            margin: 0;
            min-width: 1280px;
        }

        #left-box {
            float: left;
            display: inline-block;
            width: 840px;
        }

        #right-box {
            float: right;
            display: inline-block;
            width: 264px;
        }

        #tag-list-box {
            padding: 8px;
        }

        #null-return-data {
            display: none;
        }

        #article-recommend-list-frame {
            display: none;
        }

        #tag-list-frame {
            display: none;
        }

        .article-preview-item {
            margin-bottom: 8px;
            position: relative;
            padding: 1.2em;
        }

        .article-preview-item:hover {
            cursor: default;
        }

        .article-preview-item-img {
            width: 192px;
            height: 128px;
        }

        .article-preview-item-infos {
            width: 580px;
            margin-left: 1em;
            vertical-align: top;
            display: inline-block;
        }

        .article-preview-item-title {
            display: block;
            white-space: nowrap;
            text-overflow: ellipsis;
            max-width: 20em;
            overflow-x: hidden;
            font-weight: bolder;
        }

        .article-preview-item-title:hover {
            color: cadetblue;
        }

        .article-preview-item-intro {
            max-height: 3em;
            text-indent: 2em;
            overflow-y: hidden;
            font-size: small;
            color: darkgray;
        }

        .article-preview-item-read-btn {
            transition-property: background-color;
            transition-duration: 200ms;
            right: 0;
            bottom: 1.6em;
            position: absolute;
            font-size: small;
            margin-left: 1em;
            padding: 4px 12px;
            border: none;
            color: white;
            background-color: cornflowerblue;
        }

        .article-preview-item-read-btn:hover {
            cursor: pointer;
            background-color: GrayText;
        }

        .article-preview-item-date {
            position: absolute;
            bottom: 1.7em;
            color: GrayText;
            font-size: small;
            left: 16.4em;
        }

        .article-preview-item-read-count {
            position: absolute;
            bottom: 1.8em;
            color: GrayText;
            font-size: small;
            left: 26em;
        }

        .article-preview-item-mark {
            background-color: red;
            color: white;
            position: absolute;
            padding: 2px 6px;
            left: 0;
            top: 1.2em;
        }

        .article-recommend-item {
            transition-property: background-color;
            transition-duration: 200ms;
            padding: 0.5em;
        }

        .article-recommend-item:hover {
            background-color: whitesmoke;
        }

        .article-recommend-item:hover > label {
            color: cornflowerblue;
        }

        .article-recommend-item > img {
            width: 4em;
            height: 3em;
            vertical-align: middle;
        }

        .article-recommend-item > label {
            margin-left: 0.5em;
            font-size: small;
            vertical-align: middle;
            font-weight: bold;
            color: GrayText;
            max-width: 10em;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow-x: hidden;
            display: inline-block;
        }

        .tag-item {
            margin: 2px;
            display: inline-block;
            background-color: cornflowerblue;
            border-radius: 4px;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            font-size: small;
            padding: 1px 6px;
        }

        .tag-item:hover {
            color: white;
            cursor: pointer;
        }

        .date-classify-item {
            transition-duration: 200ms;
            transition-property: background-color;
            padding: 4px 0;
        }

        .date-classify-item > label:nth-child(1) {
            color: GrayText;
            width: 65%;
            padding-left: 0.8em;
            display: inline-block;
            font-size: xx-small;
        }

        .date-classify-item > label:nth-child(2) {
            margin-left: 1em;
            color: darkgray;
            width: 20%;
            text-align: right;
            display: inline-block;
            font-size: xx-small;
        }

    </style>

    <script>

        var PAGE_VARS = {
            RND_COLORS: [
                '#DD0000',
                '#00AA00',
                '#FFAA00',
                '#0088BB',
                '#CC88BB'
            ]
        };

        $(window).ready(function () {
            $('#nav-space-fill').css('height', $('#nav-box').height());

            //test load date-classify item
            // date_classify_list_add_item({id: 1, date: '2017年12月', articleCount: 10});
            // date_classify_list_add_item({id: 2, date: '2018年1月', articleCount: 1});
            // date_classify_list_add_item({id: 3, date: '2018年2月', articleCount: 11});


            //load tags
            $.get(api_url('/article/tags/list'), function (retData) {
                if (retData.code == 200) {
                    retData.data.forEach(function (item) {
                        tag_list_add_item(item);
                    });
                    $('#article-recommend-list-frame').show().addClass('zoomIn animated');
                }
            });

            //load recommend article
            $.get(api_url('/article/recommend/list'), function (retData) {
                if (retData.code == 200) {
                    retData.data.forEach(function (item) {
                        recommend_list_add_item(item);
                    });
                    $('#tag-list-frame').show().addClass('zoomIn animated');
                }
            });

            //ajax load article preview
            var tagId = get_url_param('tagid');
            if (!tagId) {
                $.post(api_url('/article/preview/list'), {
                    len: 5
                }, articlePreviewCallback);
            } else {
                $.post(api_url('/article/preview/list'), {
                    len: 5,
                    tag_id: tagId
                }, articlePreviewCallback);
            }

            function articlePreviewCallback(retData) {
                if (retData.code == 200) {
                    if (retData.data.length == 0) {
                        $('#null-return-data').show();
                        return;
                    }
                    retData.data.forEach(function (item) {
                        article_list_add_item(item)
                    });
                } else {
                    window.location.href = 'home.html';
                }
            }
        });

        $(window).scroll(function (e) {
            var navbox = $('#nav-box');
            if ($(document).scrollTop() > 160) {
                navbox.removeClass('slideInDown').addClass('slideOutUp').addClass('animated');
            } else {
                navbox.removeClass('slideOutUp').addClass('slideInDown');
            }
            navbox.css('left', -$(document).scrollLeft())
        });


        function recommend_list_add_item(item) {
            $('#article-recommend-list-box').append(
                $('<div class="article-recommend-item">')
                    .append($('<img>').attr('src', item.coverUrl))
                    .append($('<label>').text(item.title))
                    .click(function () {
                        window.location.href = 'article-detail.html?id=' + item.id;
                    })
            );
        }

        function article_list_add_item(item) {
            $('#article-list-box').append(
                $('<div class="article-preview-item yot-box flipInX animated">')
                    .append($('<img class="article-preview-item-img">')
                        .attr('src', item.coverUrl)
                        .hover(function () {
                            $(this).addClass('pulse').addClass('animated')
                                .one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',
                                    function () {
                                        $(this).removeClass('pulse').removeClass('animated');
                                    });
                        })
                    )
                    .append($('<span class="article-preview-item-mark">').text('原创'))
                    .append($('<div class="article-preview-item-infos">')
                        .append($('<label class="article-preview-item-title">')
                            .text(item.title)
                            .click(function () {
                                window.location.href = 'article-detail.html?id=' + item.id;
                            }))
                        .append($('<p class="article-preview-item-intro">').text(item.intro))
                    )
                    .append($('<span class="article-preview-item-date">')
                        .text(date_format(item.createTime, 'y年m月d日'))
                    )
                    .append($('<span class="article-preview-item-read-count fa fa-eye">')
                        .text(' ' + item.readCount)
                    )
                    .append(
                        $('<button class="article-preview-item-read-btn">')
                            .text('阅读全文')
                            .click(function () {
                                window.location.href = 'article-detail.html?id=' + item.id;
                            })
                    )
            );
        }

        function tag_list_add_item(item) {
            $('#tag-list-box').append(
                $('<span class="tag-item">')
                    .css('backgroundColor',
                        PAGE_VARS.RND_COLORS[random_integer(PAGE_VARS.RND_COLORS.length)]
                    )
                    .text(item.name)
                    .click(function () {
                        window.location.href = 'articles.html?tagid=' + item.id;
                    })
            );
        }

        function date_classify_list_add_item(item) {
            $('#date-classify-list-box').append(
                $('<div class="date-classify-item">')
                    .append($('<label>').text(item.date))
                    .append($('<label>').text(item.articleCount))
            );
        }

    </script>
</head>

<body>
<div id="nav-box">
    <div id="top-nav">
        <div id="nav-left">
            <img src="../static/images/yotwei.png">
        </div>
        <div id="nav-right">
            <div class="nav-item" onclick="window.location.href='home.html'">
                <i class="fa fa-home"></i>
                <strong>首页</strong>
            </div>

            <div class="nav-item nav-item-act">
                <i class="fa fa-newspaper-o"></i>
                <strong>全部文章</strong>
            </div>
            <div class="nav-item" onclick="window.location.href='guestmsg.html'">
                <i class="fa fa-sticky-note-o"></i>
                <strong>留言板</strong>
            </div>
            <i id="search-button" class="fa fa-search"></i>
        </div>

    </div>
</div>
<div id="nav-space-fill">
</div>

<div id="content-box">
    <!--main content-->
    <div id="left-box">
        <div id="article-list-box">
        </div>
        <div id="null-return-data">
            <h4 style="text-align: center">这个分类下还没有文章 (:</h4>
        </div>
    </div>
    <div id="right-box">
        <div id="article-recommend-list-frame" class="yot-box">
            <div class="module-sub-title">
                <span class="fa fa-th-list"></span>
                <label>博主推荐</label>
            </div>
            <div id="article-recommend-list-box">
            </div>
        </div>

        <div id="tag-list-frame" style="margin-top: 8px" class="yot-box">
            <div class="module-sub-title">
                <span class="fa fa-th-list"></span>
                <label>标签分类</label>
            </div>
            <div id="tag-list-box">

            </div>
        </div>

        <!--
        <div style="margin-top: 8px; " class="yot-box">
            <div class="module-sub-title">
                <span class="fa fa-th-list">
                </span>
                <label>文章存档</label>
            </div>
            <div id="date-classify-list-box">
            </div>
        </div>
        -->

    </div>
</div>

</body>
</html>