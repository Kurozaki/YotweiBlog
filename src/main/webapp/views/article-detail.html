<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>正在加载...</title>

    <link rel="stylesheet" href="../static/css/yot-nav.css">
    <link rel="stylesheet" href="../static/css/yot-style.css">
    <link rel="stylesheet" href="../static/css/font-awesome.css">
    <link rel="stylesheet" href="../static/css/animate.css">
    <script src="../static/js/jquery-3.2.1.min.js"></script>
    <script src="../static/js/functions.js"></script>

    <style>
        body {
            background: url("../static/images/bj.png");
            background-repeat: repeat;
            background-attachment: fixed;
            overflow-y: scroll;
            margin: 0;
            min-width: 1280px;
        }

        #left-box {
            transition-property: width;
            transition-duration: 300ms;
            float: left;
            width: 840px;
        }

        #right-box {
            width: 264px;
            float: right;
        }

        #article-content {
            padding: 12px;
            font-size: small;
            border-top: 1px solid #eeeeee;
        }

        #article-title {
            font-weight: bolder;
        }

        #article-info-box {
            text-align: center;
        }

        #article-detail-box {
            display: none;
            position: relative;
        }

        #article-date {
            color: GrayText;
            font-size: small;
        }

        #article-read-count {
            margin-left: 2em;
            color: GrayText;
            font-size: small;
        }

        #article-top-bar {
            min-height: 1.2em;
            padding: 12px 18px 0 18px;
        }

        #article-top-bar > span {
            transition-property: background-color;
            transition-duration: 200ms;
            border-radius: 1px;
            padding: 4px;
            font-size: small;
            border: 1px solid darkgray;
            color: GrayText;
        }

        #article-top-bar > span:hover {
            cursor: pointer;
            color: white;
            background-color: darkgray;
        }

        #article-tags {
            color: darkgray;
            font-size: small;
            padding: 8px;
            background-color: whitesmoke;
        }

        #tag-list-box {
            padding: 8px;
        }

        #tag-list-frame {
            display: none;
        }

        #article-recommend-list-frame {
            display: none;
        }

        #loading-box {
            padding: 1em;
            text-align: center;
            font-size: larger;
        }

        .article-tag-item {
            transition: 200ms;
            vertical-align: bottom;
            margin-left: 2px;
            border-radius: 2px;
            color: gray;
            border: 1px solid #aaaaaa;
            padding: 0 4px;
        }

        .tag-item {
            margin: 2px;
            display: inline-block;
            background-color: cornflowerblue;
            border-radius: 4px;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            font-size: small;
            padding: 1px 6px;
        }

        .tag-item:hover {
            color: white;
            cursor: pointer;
        }

        .article-recommend-item {
            transition-property: background-color;
            transition-duration: 200ms;
            padding: 0.5em;
        }

        .article-recommend-item:hover {
            background-color: whitesmoke;
        }

        .article-recommend-item:hover > label {
            color: cornflowerblue;
        }

        .article-recommend-item > img {
            width: 4em;
            height: 3em;
            vertical-align: middle;
        }

        .article-recommend-item > label {
            margin-left: 0.5em;
            font-size: small;
            vertical-align: middle;
            font-weight: bold;
            color: GrayText;
            max-width: 10em;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow-x: hidden;
            display: inline-block;
        }

        .article-tag-item:hover {
            color: white;
            cursor: pointer;
            background-color: gray;
        }
    </style>

    <script>
        var PAGE_VARS = {
            RND_COLORS: [
                '#DD0000',
                '#00AA00',
                '#FFAA00',
                '#0088BB',
                '#CC88BB'
            ]
        };

        $(window).ready(function () {
            $('#nav-space-fill').css('height', $('#nav-box').height());

            var id = get_url_param('id');
            if (!id) {
                //todo to error or default page
                window.location.href = 'home.html';
            }

            $.get(api_url('/article/detail/' + id), function (retData) {
                if (retData.code != 200) {
                    alert(retData.message);
                    return;
                }
                var articleDetail = retData.data;

                //填充内容
                $('#article-title').text(articleDetail.article.title);
                $('#article-read-count').text(' ' + articleDetail.article.readCount);
                $('#article-date').text(' ' + date_format(articleDetail.article.createTime, "y年m月d日"));
                $('#article-content').html(articleDetail.article.content);

                $(document).attr('title', articleDetail.article.title);

                articleDetail.tags.forEach(function (item) {
                    $('#article-tags').append($('<span class="article-tag-item">').text(item.name));
                });

                $('#loading-box').hide();
                $('#article-detail-box').fadeIn();
            });

            $.get(api_url('/article/recommend/list'), function (retData) {
                if (retData.code == 200) {
                    retData.data.forEach(function (item) {
                        recommend_list_add_item(item);
                    })
                }
                $('#article-recommend-list-frame').show().addClass('zoomIn animated');
            });

            $.get(api_url('/article/tags/list'), function (retData) {
                if (retData.code == 200) {
                    retData.data.forEach(function (item) {
                        tag_list_add_item(item);
                    });
                    $('#tag-list-frame').show().addClass('zoomIn animated');
                }
            });
        });


        $(window).scroll(function () {
            var navbox = $('#nav-box');
            if ($(document).scrollTop() > 160) {
                navbox.removeClass('slideInDown').addClass('slideOutUp').addClass('animated');
            } else {
                navbox.removeClass('slideOutUp').addClass('slideInDown');
            }
            navbox.css('left', -$(document).scrollLeft())
        });

        function recommend_list_add_item(item) {
            $('#article-recommend-list-box').append(
                $('<div class="article-recommend-item">')
                    .append($('<img>').attr('src', item.coverUrl))
                    .append($('<label>').text(item.title))
                    .click(function () {
                        window.location.href = 'article-detail.html?id=' + item.id;
                    })
            );
        }


        function tag_list_add_item(item) {
            $('#tag-list-box').append(
                $('<span class="tag-item">')
                    .css('backgroundColor',
                        PAGE_VARS.RND_COLORS[random_integer(PAGE_VARS.RND_COLORS.length)]
                    )
                    .text(item.name)
                    .click(function () {
                        window.location.href = 'articles.html?tagid=' + item.id;
                    })
            );
        }

        function spread_article() {
            $('#right-box').hide();
            $('#left-box').css('width', '100%');
            $('#btn-shrink').show();
            $('#btn-spread').hide();
        }

        function shrink_article() {
            $('#left-box').css('width', '840px');
            $('#btn-shrink').hide();
            $('#btn-spread').show();
            setTimeout(function () {
                $('#right-box').fadeIn();
            }, 300);
        }
    </script>
</head>

<body>
<div id="nav-box">
    <div id="top-nav">
        <div id="nav-left">
            <img src="../static/images/yotwei.png">
        </div>
        <div id="nav-right">
            <div class="nav-item" onclick="window.location.href='home.html'">
                <i class="fa fa-home"></i>
                <strong>首页</strong>
            </div>

            <div class="nav-item" onclick="window.location.href='articles.html'">
                <i class="fa fa-newspaper-o"></i>
                <strong>全部文章</strong>
            </div>
            <div class="nav-item" onclick="window.location.href='guestmsg.html'">
                <i class="fa fa-sticky-note-o"></i>
                <strong>留言板</strong>
            </div>
            <i id="search-button" class="fa fa-search"></i>
        </div>

    </div>
</div>
<div id="nav-space-fill">
</div>

<div id="content-box">
    <div id="left-box">

        <div id="loading-box">
            <span class="fa fa-spin fa-spinner"></span>
            加载中...
        </div>

        <div id="article-detail-box" class="yot-box">
            <div id="article-info-box">
                <div id="article-top-bar">
                    <span style="float: left" class="fa fa-hand-o-left"
                          onclick="window.location.href='home.html'"> 回到首页</span>
                    <span id="btn-spread" style="float: right;"
                          class="fa fa-align-right" onclick="spread_article()"> 展开</span>
                    <span id="btn-shrink" style="float: right; display: none"
                          class="fa fa-align-left" onclick="shrink_article()"> 收起</span>
                </div>
                <h3 id="article-title">[文章标题]</h3>
                <div style="margin-bottom: 8px">
                    <span id="article-date" class="fa fa-calendar"> [date]</span>
                    <span id="article-read-count" class="fa fa-eye"> [read count]</span>
                </div>
            </div>
            <div id="article-content">
                [content]
            </div>
            <div id="article-tags">
                <span>所属分类:</span>
            </div>
        </div>
    </div>
    <div id="right-box">
        <div id="article-recommend-list-frame" class="yot-box">
            <div class="module-sub-title">
                <span class="fa fa-th-list"></span>
                <label>博主推荐</label>
            </div>
            <div id="article-recommend-list-box">
            </div>
        </div>

        <div id="tag-list-frame" style="margin-top: 8px" class="yot-box">

            <div class="module-sub-title">
                <span class="fa fa-th-list"></span>
                <label>标签分类</label>
            </div>
            <div id="tag-list-box">

            </div>
        </div>

    </div>
</div>

</body>
</html>